<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" 
						"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="kr.kro.bbanggil.bakery.mapper.BakeryMapper">
<resultMap id="bakeryInfoResultMap" type="kr.kro.bbanggil.bakery.dto.response.bakeryUpdateResponseDTO">
	<result property="bakeryNo" column="bakery_no"></result>
	<result property="bakeryName" column="bakery_name"></result>
	<result property="bakeryAddress" column="bakery_address"></result>
	<result property="createdDate" column="created_date"></result>
	<result property="insideInfo" column="inside_info"></result>
	<result property="outsideInfo" column="outside_info"></result>
	<result property="parkingInfo" column="amenity"></result>
</resultMap>

<resultMap id="bakeryImgResultMap" type="kr.kro.bbanggil.bakery.dto.request.FileRequestDTO">
	<result property="changeName" column="change_name"></result>
	<result property="folderNamePath" column="folder_name_path"></result>
</resultMap>

<resultMap id="bakeryScheduleResultMap" type="kr.kro.bbanggil.bakery.dto.BakeryTimeSetDTO">
	<result property="day" column="day"></result>
	<result property="start" column="open_time"></result>
	<result property="end" column="close_time"></result>
</resultMap>
	
	<select id="getBakeryInfo" resultMap="bakeryInfoResultMap">
		SELECT bi.BAKERY_NO,
			   bi.BAKERY_NAME,
			   bi.BAKERY_ADDRESS,
			   bd.AMENITY,
			   bd.INSIDE_INFO,
			   bd.OUTSIDE_INFO,
			   bd.CREATED_DATE 
		FROM BAKERY_INFO bi 
		JOIN BAKERY_DETAIL bd ON bi.BAKERY_NO = bd.BAKERY_NO
		WHERE bi.bakery_no = ${bakeryNo}
	</select>
	<select id="getBakeryImg" resultMap="bakeryImgResultMap">
	SELECT CHANGE_NAME,
		   FOLDER_NAME_PATH
	FROM BAKERY_IMAGE bi
	WHERE bakery_no = ${bakeryNo}
	</select>

	<select id="getBakerySchedule" resultMap="bakeryScheduleResultMap">
	SELECT day,open_time,close_time
	FROM BAKERY_SCHEDULE bs
	WHERE bakery_no =${bakeryNo}
	</select>

	<insert id="menuInsert">
	<selectKey resultType="int" keyProperty="menuNo" order="BEFORE">
		SELECT menu_seq.nextval from dual
	</selectKey>
		INSERT INTO menu VALUES(#{menuRequestDTO.menuNo},
								#{menuRequestDTO.menuName},
								#{menuRequestDTO.menuPrice},
								#{menuRequestDTO.menuPopulity},
								#{bakeryNo},
								#{menuRequestDTO.menuCategory})
	</insert>
	<insert id="menuFileUpload">
	INSERT INTO menu_image
		VALUES(menu_img_seq.nextval,
			   #{fileDTO.changeName},
			   #{fileDTO.originalName},
			   #{fileDTO.extension},
			   #{fileDTO.size},
			   #{fileDTO.localPath},
			   #{fileDTO.localResourcePath},
			   #{fileDTO.folderNamePath},
			   #{menuNo})
	</insert>
	
	
	
	<select id="getCategory">
		SELECT category_no AS categoryNo,
			   category
		FROM menu_category
	</select>
	
	<insert id="bakeryFileUpload">
		INSERT INTO bakery_Image
		VALUES(img_seq.nextval,
			   #{fileDTO.changeName},
			   #{fileDTO.originalName},
			   #{fileDTO.extension},
			   #{fileDTO.size},
			   #{fileDTO.localPath},
			   #{fileDTO.localResourcePath},
			   #{fileDTO.folderNamePath},
			   #{imgLocation},
			   #{bakeryNo},
			   '')
	</insert>
	<insert id="bakeryInsert">
		<selectKey resultType="int" keyProperty="bakeryNo" order="BEFORE">
			SELECT bakery_seq.nextval from dual
		</selectKey>
			INSERT INTO bakery_info
			VALUES(#{bakeryNo},
				   #{bakeryName},
				   #{bakeryAddress},
				   #{bakeryPhone},
				   #{latitude},
				   #{longitude},
				   #{region})
	</insert>
	<insert id="bakeryDetailInsert">
		INSERT INTO bakery_detail
		VALUES(#{bakeryNo},
			   #{amenity},
			   #{insideInfo},
			   #{outsideInfo},
			   #{createdDate},
			   sysdate)
	</insert>
	<insert id="bakeryScheduleInsert">
		INSERT INTO bakery_schedule
		VALUES(schedule_seq.nextval,
			   #{bakeryNo},
			   #{timeDTO.day},
			   #{timeDTO.start},
			   #{timeDTO.end})
	</insert>
	<insert id="setBakery">
		INSERT INTO bakery_access
		VALUES(#{bakeryNo},
			   'N',
			   #{userNo})
	</insert>
</mapper>